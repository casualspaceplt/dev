!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/platform-browser"),require("@angular/common"),require("@angular/cdk/a11y"),require("@angular/animations"),require("@angular/cdk/portal"),require("@angular/cdk/overlay"),require("@angular/cdk/keycodes"),require("rxjs"),require("ng-gallery"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("ng-gallery/lightbox",["exports","@angular/core","@angular/platform-browser","@angular/common","@angular/cdk/a11y","@angular/animations","@angular/cdk/portal","@angular/cdk/overlay","@angular/cdk/keycodes","rxjs","ng-gallery","rxjs/operators"],t):t(((e=e||self)["ng-gallery"]=e["ng-gallery"]||{},e["ng-gallery"].lightbox={}),e.ng.core,e.ng.platformBrowser,e.ng.common,e.ng.cdk.a11y,e.ng.animations,e.ng.cdk.portal,e.ng.cdk.overlay,e.ng.cdk.keycodes,e.rxjs,e["ng-gallery"],e.rxjs.operators)}(this,(function(e,t,r,i,n,o,a,s,l,c,u,p){"use strict";var g=new t.InjectionToken("LIGHTBOX_CONFIG"),d=o.trigger("lightbox",[o.state("void, exit",o.style({opacity:0,transform:"scale(0.7)"})),o.state("enter",o.style({transform:"none"})),o.transition("* => enter",o.animate("{{startAnimationTime}}ms cubic-bezier(0, 0, 0.2, 1)",o.style({transform:"none",opacity:1}))),o.transition("* => void, * => exit",o.animate("{{exitAnimationTime}}ms cubic-bezier(0.4, 0.0, 0.2, 1)",o.style({opacity:0})))]),h=function(){function e(e,t,r,i){this._document=e,this._focusTrapFactory=t,this._elementRef=r,this.sanitizer=i,this.state="enter",this._savePreviouslyFocusedElement()}return e.prototype.onAnimationDone=function(e){"enter"===e.toState?this._trapFocus():(this.overlayRef.dispose(),this._restoreFocus())},e.prototype._trapFocus=function(){this._focusTrap||(this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement)),this._focusTrap.focusInitialElementWhenReady()},e.prototype._savePreviouslyFocusedElement=function(){var e=this;this._document&&(this._elementFocusedBeforeDialogWasOpened=this._document.activeElement,this._elementRef.nativeElement.focus&&Promise.resolve().then((function(){return e._elementRef.nativeElement.focus()})))},e.prototype._restoreFocus=function(){var e=this._elementFocusedBeforeDialogWasOpened;e&&"function"==typeof e.focus&&e.focus(),this._focusTrap&&this._focusTrap.destroy()},e}();h.decorators=[{type:t.Component,args:[{selector:"lightbox",changeDetection:t.ChangeDetectionStrategy.OnPush,animations:[d],template:'\n    <gallery [id]="id" [destroyRef]="false" [skipInitConfig]="true">\n      <i class="g-btn-close" aria-label="Close" (click)="overlayRef.detach()"\n         [innerHTML]="sanitizer.bypassSecurityTrustHtml(closeIcon)"></i>\n    </gallery>\n  ',host:{tabindex:"-1","aria-modal":"true","[attr.id]":'"lightbox-" + id',"[attr.role]":"role","[attr.aria-labelledby]":"ariaLabel ? null : ariaLabelledBy","[attr.aria-label]":"ariaLabel","[attr.aria-describedby]":"ariaDescribedBy || null","[@lightbox]":"{ value: state, params: { startAnimationTime: startAnimationTime, exitAnimationTime: exitAnimationTime } }","(@lightbox.done)":"onAnimationDone($event)"},styles:["::ng-deep lightbox{border-radius:4px;box-shadow:0 11px 15px -7px rgba(0,0,0,.2),0 24px 38px 3px rgba(0,0,0,.14),0 9px 46px 8px rgba(0,0,0,.12);display:block;height:800px;max-height:90vh;max-width:94vw;overflow:hidden;position:relative;width:1100px}::ng-deep lightbox:focus{outline:none}::ng-deep lightbox gallery{display:block;height:100%;margin:0;overflow:hidden;width:100%}::ng-deep .g-backdrop{background-color:rgba(0,0,0,.32)}::ng-deep .fullscreen{width:100%}::ng-deep .fullscreen ::ng-deep lightbox{border-radius:0;bottom:0;height:100%;left:0;max-height:unset;max-width:unset;position:fixed;right:0;top:0;width:100%}::ng-deep .g-overlay{margin:auto}@media only screen and (max-width:480px){::ng-deep .g-overlay{width:100%}::ng-deep .g-overlay ::ng-deep lightbox{border-radius:0;bottom:0;height:100%;left:0;max-height:unset;max-width:unset;position:fixed;right:0;top:0;width:100%}}::ng-deep .g-btn-close{cursor:pointer;height:20px;position:absolute;right:.9em;top:.9em;width:20px;z-index:60}@media only screen and (max-width:480px){::ng-deep .g-btn-close{right:.7em;top:.7em}}"]}]}],h.ctorParameters=function(){return[{type:void 0,decorators:[{type:t.Optional},{type:t.Inject,args:[i.DOCUMENT]}]},{type:n.ConfigurableFocusTrapFactory},{type:t.ElementRef},{type:r.DomSanitizer}]};var y={backdropClass:"g-backdrop",panelClass:"g-overlay",hasBackdrop:!0,keyboardShortcuts:!0,role:"lightbox",startAnimationTime:150,exitAnimationTime:75,closeIcon:'<?xml version="1.0" encoding="UTF-8"?>\n<svg width="512px" height="512px" enable-background="new 0 0 47.971 47.971" version="1.1" viewBox="0 0 47.971 47.971" xml:space="preserve" xmlns="http://www.w3.org/2000/svg">\n\t<path d="M28.228,23.986L47.092,5.122c1.172-1.171,1.172-3.071,0-4.242c-1.172-1.172-3.07-1.172-4.242,0L23.986,19.744L5.121,0.88   c-1.172-1.172-3.07-1.172-4.242,0c-1.172,1.171-1.172,3.071,0,4.242l18.865,18.864L0.879,42.85c-1.172,1.171-1.172,3.071,0,4.242   C1.465,47.677,2.233,47.97,3,47.97s1.535-0.293,2.121-0.879l18.865-18.864L42.85,47.091c0.586,0.586,1.354,0.879,2.121,0.879   s1.535-0.293,2.121-0.879c1.172-1.171,1.172-3.071,0-4.242L28.228,23.986z" fill="#fff"/>\n</svg>\n'},m=function(){function e(e,t,r){this._gallery=t,this._overlay=r,this.opened=new c.Subject,this.closed=new c.Subject,this._config=e?Object.assign(Object.assign({},y),e):y}return e.prototype.setConfig=function(e){this._config=Object.assign(Object.assign({},this._config),e)},e.prototype.open=function(e,t,r){var i=this;void 0===e&&(e=0),void 0===t&&(t="lightbox");var n=r?Object.assign(Object.assign({},this._config),r):this._config,o={backdropClass:n.backdropClass,panelClass:n.panelClass,hasBackdrop:n.hasBackdrop,positionStrategy:this._overlay.position().global().centerHorizontally().centerVertically(),scrollStrategy:this._overlay.scrollStrategies.block(),disposeOnNavigation:!0},s=this._gallery.ref(t);s.set(e),this._overlayRef=this._overlay.create(o),this._overlayRef.attachments().subscribe((function(){return i.opened.next(t)})),this._overlayRef.detachments().subscribe((function(){return i.closed.next(t)}));var c=new a.ComponentPortal(h),u=this._overlayRef.attach(c);u.instance.id=t,u.instance.overlayRef=this._overlayRef,u.instance.closeIcon=this._config.closeIcon,u.instance.role=this._config.role,u.instance.ariaLabel=this._config.ariaLabel,u.instance.ariaLabelledBy=this._config.ariaLabelledBy,u.instance.ariaDescribedBy=this._config.ariaDescribedBy,u.instance.startAnimationTime=this._config.startAnimationTime,u.instance.exitAnimationTime=this._config.exitAnimationTime,n.hasBackdrop&&this._overlayRef.backdropClick().subscribe((function(){return i.close()})),n.keyboardShortcuts&&this._overlayRef.keydownEvents().subscribe((function(e){switch(e.keyCode){case l.LEFT_ARROW:s.prev();break;case l.RIGHT_ARROW:s.next();break;case l.ESCAPE:i.close()}}))},e.prototype.close=function(){this._overlayRef.hasAttached()&&this._overlayRef.detach()},e}();m.decorators=[{type:t.Injectable}],m.ctorParameters=function(){return[{type:void 0,decorators:[{type:t.Optional},{type:t.Inject,args:[g]}]},{type:u.Gallery},{type:s.Overlay}]};var f=function(){function e(e,t,r,n,o,a,s,l){this._zone=e,this._el=t,this._gallery=r,this._lightbox=n,this._renderer=o,this._document=s,this._galleryCmp=l,this._galleryId="lightbox",this.selector="img",i.isPlatformBrowser(a)&&(this._mode=l?"gallery":"detector")}return e.prototype.ngOnInit=function(){var e=this;this._zone.runOutsideAngular((function(){e._galleryId=e.gallerize||e._galleryId;var t=e._gallery.ref(e._galleryId);switch(e._mode){case"detector":e.detectorMode(t);break;case"gallery":e.galleryMode(t)}}))},e.prototype.ngOnDestroy=function(){switch(this._mode){case"detector":this._detector$.complete(),this._observer$.disconnect();break;case"gallery":this._itemClick$.unsubscribe(),this._itemChange$.unsubscribe()}},e.prototype.galleryMode=function(e){var t=this;this._itemClick$=this._galleryCmp.galleryRef.itemClick.subscribe((function(e){return t._lightbox.open(e,t._galleryId)})),this._itemChange$=this._galleryCmp.galleryRef.itemsChanged.subscribe((function(t){return e.load(t.items)}))},e.prototype.detectorMode=function(e){var t=this;this._detector$=new c.Subject,this._detector$.pipe(p.debounceTime(300),p.switchMap((function(){var r=t._el.nativeElement.querySelectorAll(t.selector);if(r&&r.length){var i=[];return c.from(r).pipe(p.map((function(e,r){if(t._renderer.setStyle(e,"cursor","pointer"),t._renderer.setProperty(e,"onclick",(function(){return t._zone.run((function(){return t._lightbox.open(r,t._galleryId)}))})),e instanceof HTMLImageElement)return{src:e.getAttribute("imageSrc")||e.src,thumb:e.getAttribute("thumbSrc")||e.src};var i=(e.currentStyle||t._document.defaultView.getComputedStyle(e,null)).backgroundImage.slice(4,-1).replace(/"/g,"");return{src:e.getAttribute("imageSrc")||i,thumb:e.getAttribute("thumbSrc")||i}})),p.tap((function(e){return i.push(new u.ImageItem(e))})),p.finalize((function(){return e.load(i)})))}return c.EMPTY}))).subscribe(),this._observer$=new MutationObserver((function(){return t._detector$.next()})),this._observer$.observe(this._el.nativeElement,{childList:!0,subtree:!0})},e}();f.decorators=[{type:t.Directive,args:[{selector:"[gallerize]"}]}],f.ctorParameters=function(){return[{type:t.NgZone},{type:t.ElementRef},{type:u.Gallery},{type:m},{type:t.Renderer2},{type:Object,decorators:[{type:t.Inject,args:[t.PLATFORM_ID]}]},{type:void 0,decorators:[{type:t.Inject,args:[i.DOCUMENT]}]},{type:u.GalleryComponent,decorators:[{type:t.Host},{type:t.Self},{type:t.Optional}]}]},f.propDecorators={gallerize:[{type:t.Input}],selector:[{type:t.Input}]};var b=function(){function e(e,t,r){this._lightbox=e,this._el=t,this._renderer=r,this.clickEvent=c.Subscription.EMPTY,this.index=0,this.id="root"}return e.prototype.ngOnInit=function(){var e=this;this._renderer.setStyle(this._el.nativeElement,"cursor","pointer"),this.clickEvent=c.fromEvent(this._el.nativeElement,"click").pipe(p.tap((function(){return e._lightbox.open(e.index,e.id)}))).subscribe()},e.prototype.ngOnDestroy=function(){this.clickEvent.unsubscribe()},e}();b.decorators=[{type:t.Directive,args:[{selector:"[lightbox]"}]}],b.ctorParameters=function(){return[{type:m},{type:t.ElementRef},{type:t.Renderer2}]},b.propDecorators={index:[{type:t.Input,args:["lightbox"]}],id:[{type:t.Input,args:["gallery"]}]};var _=function(){function e(){}return e.withConfig=function(t){return{ngModule:e,providers:[{provide:g,useValue:t}]}},e}();_.decorators=[{type:t.NgModule,args:[{imports:[s.OverlayModule,u.GalleryModule,n.A11yModule],declarations:[h,b,f],exports:[b,f],providers:[m],entryComponents:[h]}]}],e.GallerizeDirective=f,e.LIGHTBOX_CONFIG=g,e.Lightbox=m,e.LightboxComponent=h,e.LightboxModule=_,e.ɵa=d,e.ɵb=b,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=ng-gallery-lightbox.umd.min.js.map